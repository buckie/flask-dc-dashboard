<script>
    // use static or load via d3.csv("spendData.csv", function(error, spendData) {/* do stuff */});
    var spendData = {{ data|safe }};


    // set crossfilter
    var ndx = crossfilter(spendData),
            yearDim  = ndx.dimension(function(d) {return d.Year;}),
            spendDim = ndx.dimension(function(d) {return Math.floor(d.Spent/10);}),
            nameDim  = ndx.dimension(function(d) {return d.Name;}),
            spendPerYear = yearDim.group().reduceSum(function(d) {return d.Spent;}),
            spendPerName = nameDim.group().reduceSum(function(d) {return d.Spent;}),
            spendHist    = spendDim.group().reduceCount();

{#{{ declare_charts(charts) }}#}
var yearRingChart = dc.pieChart("#chart-ring-year");


yearRingChart
.width(200).height(200)
.dimension(yearDim)
.group(spendPerYear)
.innerRadius(50);

</script>
<script>
    var spendHistChart  = dc.barChart("#chart-hist-spend");
spendHistChart
.width(300).height(200)
.dimension(spendDim)
.group(spendHist)
.x(d3.scale.linear().domain([0,10]))
.elasticY(true);

spendHistChart.xAxis().tickFormat(function(d) {return d*10}); // convert back to base unit
spendHistChart.yAxis().ticks(2);

    var spenderRowChart = dc.rowChart("#chart-row-spenders");
spenderRowChart
.width(350).height(200)
.dimension(nameDim)
.group(spendPerName)
.elasticX(true);
</script>

<script>
dc.renderAll();
</script>
